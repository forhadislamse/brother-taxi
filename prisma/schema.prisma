generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  RIDER
  DRIVER
  // PENDING
}

enum AdminApprovedStatus {
  PENDING
  APPROVED
  REJECTED
}

enum UserStatus {
  ACTIVE
  INACTIVE
  BLOCKED
}

enum RideStatus {
  REQUESTED
  ACCEPTED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum TransportStatus {
  ONGOING
  PENDING
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
}

// model User {
//   // ───── Identity
//   id           String  @id @default(auto()) @map("_id") @db.ObjectId
//   fullName     String? @default("")
//   dob          String? @default("") // Date of Birth
//   gender       Gender? @default(MALE)
//   nidNumber    String? @default("") // National ID / SSN
//   referralCode String? // For referral program
//   documents    Json? // Store extra driver/rider documents
//   address      String? @default("") // Permanent address text

//   // ───── Contact Info
//   phoneNumber String  @unique
//   email       String? 
//   city        String? // City for drivers
//   location    String? @default("") // Current address text
//   lat         Float?  @default(0) // Current latitude
//   lng         Float?  @default(0) // Current longitude

//   // ───── Authentication & Security
//   password               String?
//   role                   UserRole   @default(PENDING)
//   status                 UserStatus @default(ACTIVE)
//   otp                    Int?
//   otpExpiresAt           DateTime?  @default(now())
//   phoneVerificationToken String?    @default("")
//   isPhoneNumberVerify    Boolean    @default(false)

//   // ───── Profile & Preferences
//   profileImage     String?
//   fcmToken         String? @default("")
//   isNotificationOn Boolean @default(false)
//   isUserOnline     Boolean @default(true)
//   onBoarding       Boolean @default(false)

//   // ───── Driver Specific
//   licensePlate     String? // Car license plate
//   drivingLicense   String? // Driving license number or file
//   licenseFrontSide String? @default("")
//   licenseBackSide  String? @default("")
//   taxiManufacturer String? // Car brand (e.g. Toyota, Honda)
//   bhNumber         String? // Driver badge number
//   isApproved       Boolean @default(false) // Admin approval for drivers

//   // ───── Stats & Metrics
//   rating        Float? @default(0)
//   totalDistance Float? @default(0) // In kilometers
//   totalRides    Int?   @default(0) // Rider trips count
//   totalTrips    Int?   @default(0) // Driver trips count

//   // ───── Timestamps
//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   // ───── Relationships
//   ridesAsRider    Ride[]   @relation("RiderRides")
//   ridesAsDriver   Ride[]   @relation("DriverRides")
//   reviewsGiven    Review[] @relation("ReviewsGiven")
//   reviewsReceived Review[] @relation("ReviewsReceived")
//   wallet          Wallet?
//   vehicles        Vehicle[]

//   @@map("users")
// }

model User {
  id           String  @id @default(auto()) @map("_id") @db.ObjectId
  fullName     String? @default("")
  dob          String? @default("")
  gender       Gender  @default(MALE)
  nidNumber    String? @default("")
  referralCode String?
  documents    Json?
  address      String? @default("")

  phoneNumber String  @unique
  email       String?
  city        String?
  location    String? @default("")
  lat         Float?  @default(0)
  lng         Float?  @default(0)

  password               String?
  role                   UserRole
  status                 UserStatus @default(ACTIVE)
  otp                    Int?
  otpExpiresAt           DateTime?
  phoneVerificationToken String?
  isPhoneNumberVerify    Boolean    @default(false)

  profileImage     String?
  fcmToken         String? @default("")
  isNotificationOn Boolean @default(false)
  isUserOnline     Boolean @default(true)
  onBoarding       Boolean @default(false)

  // Driver-specific (optional)
  licensePlate        String?
  drivingLicense      String?
  licenseFrontSide    String?             @default("")
  licenseBackSide     String?             @default("")
  taxiManufacturer    String?
  bhNumber            String?
  adminApprovedStatus AdminApprovedStatus @default(PENDING)
  // isApproved       Boolean @default(false)

  rating        Float? @default(0)
  totalDistance Float? @default(0)
  totalRides    Int?   @default(0)
  totalTrips    Int?   @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ridesAsRider    Ride[]   @relation("RiderRides")
  // ridesAsDriver   Ride[]   @relation("DriverRides")
  reviewsGiven    Review[]       @relation("ReviewsGiven")
  reviewsReceived Review[]       @relation("ReviewsReceived")
  // wallet          Wallet?
  estimateFares  EstimateFare[]
  vehicles        Vehicle[]
  carTransports   CarTransport[]
  parcelDriver    CarTransport[] @relation("ParcelDriver")
  parcelSender    CarTransport[] @relation("ParcelSender")

  @@map("users")
}

// model Wallet {
//   id      String @id @default(auto()) @map("_id") @db.ObjectId
//   balance Float  @default(0)
//   userId  String @unique @db.ObjectId
//   user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)

//   @@map("wallets")
// }

// model Ride {
//   id              String     @id @default(auto()) @map("_id") @db.ObjectId
//   distance        Float
//   fare            Float
//   startTime       DateTime
//   endTime         DateTime?
//   status          RideStatus
//   pickupLocation  String
//   dropoffLocation String
//   riderId         String     @db.ObjectId
//   driverId        String?    @db.ObjectId
//   rider           User       @relation("RiderRides", fields: [riderId], references: [id])
//   driver          User?      @relation("DriverRides", fields: [driverId], references: [id])
//   reviews         Review[]
//   createdAt       DateTime   @default(now())

//   @@map("rides")
// }

model CarTransport {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  userId    String @db.ObjectId
  vehicleId String @db.ObjectId

  // ───── Ride Locations
  pickupLocation  String? @default("")
  dropOffLocation String? @default("")
  pickupLat       Float?  @default(0)
  pickupLng       Float?  @default(0)
  dropOffLat      Float?  @default(0)
  dropOffLng      Float?  @default(0)
  driverLat       Float?  @default(0)
  driverLng       Float?  @default(0)

  // ───── Fare & Payment
  totalAmount     Float?        @default(0)
  platformFee     Float?        @default(0)
  platformFeeType String?       @default("")
  paymentMethod   String?       @default("CARD")
  paymentStatus   PaymentStatus @default(PENDING)
  isPayment       Boolean       @default(false)

  // ───── Scheduling
  pickupDate String? @default("")
  pickupTime String? @default("")
  rideTime   String? @default("")
  waitingTime String? @default("")

  // ───── Status Tracking
  status                  TransportStatus @default(PENDING)
  assignedDriver          String?         @db.ObjectId
  assignedDriverReqStatus String?         @default("PENDING")
  isDriverReqCancel       Boolean         @default(true)
  arrivalConfirmation     Boolean         @default(false)
  journeyStarted          Boolean         @default(false)
  journeyCompleted        Boolean         @default(false)

  // ───── Service Details
  // serviceType   ServiceType @default(Airport_pickup)
  specialNotes String? @default("")

  // ───── Media / Evidence
  beforePickupImages String[] @default([])
  afterPickupImages  String[] @default([])

  // ───── Cancellation
  cancelReason String? @default("") // Optional: user can provide reason for cancel

  // ───── Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ───── Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  vehicle Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  driver  User?   @relation("ParcelDriver", fields: [assignedDriver], references: [id], onDelete: Cascade)
  sender  User?   @relation("ParcelSender", fields: [userId], references: [id], onDelete: Cascade)

  Review Review[] // ride feedback
  // fare   Fare[]
  // ParcelChat ParcelChat[]    // chat between rider and driver
  // Payment    Payment[]       @relation("carTransportPayment") // multiple payments if needed

  @@map("carTransports")
}

model EstimateFare {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  userId     String   @db.ObjectId
  pickupLat  Float
  pickupLng  Float
  dropOffLat Float
  dropOffLng Float
  distance   Float
  totalFare  Float
  baseFare      Float
  costPerKm     Float
  costPerMin    Float
  minimumFare   Float
  waitingPerMin Float
  isActive      Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("estimateFares")
}


// Enums


// enum ServiceType {
//   Airport_pickup
//   Airport_dropoff
//   City_ride
//   Parcel_delivery
// }

model Review {
  id         String       @id @default(auto()) @map("_id") @db.ObjectId
  rating     Int // 1-5 stars
  comment    String?
  reviewerId String       @db.ObjectId
  reviewedId String       @db.ObjectId
  rideId     String       @db.ObjectId
  reviewer   User         @relation("ReviewsGiven", fields: [reviewerId], references: [id])
  reviewed   User         @relation("ReviewsReceived", fields: [reviewedId], references: [id])
  ride       CarTransport @relation(fields: [rideId], references: [id])
  createdAt  DateTime     @default(now())

  @@map("reviews")
}

model Vehicle {
  id                 String   @id @default(auto()) @map("_id") @db.ObjectId
  userId             String   @db.ObjectId
  manufacturer       String
  model              String
  year               Int
  image              String?
  color              String
  licensePlateNumber String   @unique
  isActive           Boolean  @default(true)
  bh                 String // same as your schema
  refferalCode       String
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  driver        User           @relation(fields: [userId], references: [id])
  carTransports CarTransport[] // Opposite relation field for CarTransport.vehicle

  @@map("vehicles")
}

model Fare {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  // carTransportId String       @db.ObjectId
  // carTransport   CarTransport @relation(fields: [carTransportId], references: [id], onDelete: Cascade)
  baseFare      Float?
  costPerKm     Float
  costPerMin    Float?
  minimumFare   Float?
  waitingPerMin Float?
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("fares")
}
